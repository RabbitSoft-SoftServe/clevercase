<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">

    <link rel="shortcut icon" href="../static/img/ico.png" type="image/x-icon">
    <link rel="stylesheet" href="../static/css/homepage.css">
    <link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=IBM+Plex+Mono:wght@700&display=swap">
    <link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@400;700&display=swap" rel="stylesheet">
    
    <title>Home</title>
</head>

<body>
    <audio id="mySound" src="../static/css/sound1.mp3"></audio>
    <header>
        <!-- Burger menu -->
        <div class="menu-container">
            <button class="burger-container header-btn">
                <img src="../static/img/home/burger-menu.svg" alt="Menu Icon" class="burger-icon">
            </button>
            <div class="burger-open">
                <a href="homepage.html" class="opened-menu-option-box">
                    <p class="opened-menu-option-box-text"> My categories </p>
                    <div class="opened-menu-option-box-icon-container">                        
                        <svg viewBox="0 0 24 24" stroke-width="1.5" fill="none" xmlns="http://www.w3.org/2000/svg" color="#252525" alt="Homepage Icon" class="homepage-icon opened-menu-icon">
                            <path d="M2 8L11.7317 3.13416C11.9006 3.04971 12.0994 3.0497 12.2683 3.13416L22 8" stroke="#252525" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"></path>
                            <path d="M20 11V19C20 20.1046 19.1046 21 18 21H6C4.89543 21 4 20.1046 4 19V11" stroke="#252525" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"></path>
                        </svg>
                    </div>
                    <div class="opened-menu-right-border"></div>
                </a>
                <div class="opened-menu-vertical-line"></div>
                <a href="regularexpenses.html" class="opened-menu-option-box">
                    <p class="opened-menu-option-box-text"> Regular expenses </p>
                    <div class="opened-menu-option-box-icon-container">
                        <svg stroke-width="1.5" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg" color="#252525" alt="Regular Expenses Icon" class="regular-expenses-icon opened-menu-icon">
                            <path d="M12 22C17.5228 22 22 17.5228 22 12C22 6.47715 17.5228 2 12 2C6.47715 2 2 6.47715 2 12C2 17.5228 6.47715 22 12 22Z" stroke="#252525" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"></path>
                            <path d="M15 8.5C14.315 7.81501 13.1087 7.33855 12 7.30872M9 15C9.64448 15.8593 10.8428 16.3494 12 16.391M12 7.30872C10.6809 7.27322 9.5 7.86998 9.5 9.50001C9.5 12.5 15 11 15 14C15 15.711 13.5362 16.4462 12 16.391M12 7.30872V5.5M12 16.391V18.5" stroke="#252525" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"></path>
                        </svg>
                    </div>
                    <div class="opened-menu-right-border"></div>
                </a>
                <div class="opened-menu-vertical-line"></div>
                <a href="analytics.html" class="opened-menu-option-box"> 
                    <p class="opened-menu-option-box-text"> Analytics </p>
                    <div class="opened-menu-option-box-icon-container">
                        <svg stroke-width="1.5" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg" color="#252525" alt="Analytics Icon" class="analytics-icon opened-menu-icon">
                            <path d="M20 20H4V4" stroke="#252525" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"></path>
                            <path d="M4 16.5L12 9L15 12L19.5 7.5" stroke="#252525" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"></path>
                        </svg> 
                    </div>
                    <div class="opened-menu-right-border"></div>
                </a>
                <div class="opened-menu-vertical-line"></div>
                <button class="opened-menu-option-box responsive-element"> 
                    <p class="opened-menu-option-box-text"> Notifications </p>
                    <div class="opened-menu-option-box-icon-container">
                        <svg stroke-width="1.5" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg" color="#252525" alt="Bell Icon" class="menu-bell-icon opened-menu-icon">
                            <path d="M18 8.4C18 6.70261 17.3679 5.07475 16.2426 3.87452C15.1174 2.67428 13.5913 2 12 2C10.4087 2 8.88258 2.67428 7.75736 3.87452C6.63214 5.07475 6 6.70261 6 8.4C6 15.8667 3 18 3 18H21C21 18 18 15.8667 18 8.4Z" stroke="#252525" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"></path>
                            <path d="M13.73 21C13.5542 21.3031 13.3019 21.5547 12.9982 21.7295C12.6946 21.9044 12.3504 21.9965 12 21.9965C11.6496 21.9965 11.3054 21.9044 11.0018 21.7295C10.6982 21.5547 10.4458 21.3031 10.27 21" stroke="#252525" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"></path>
                        </svg>
                    </div>
                    <div class="opened-menu-right-border"></div>
                </button>
                <div class="opened-menu-vertical-line responsive-element"></div>
                <button class="opened-menu-option-box responsive-element"> 
                    <p class="opened-menu-option-box-text"> Profile </p>
                    <div class="opened-menu-option-box-icon-container">
                        <svg stroke-width="1.5" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg" color="#252525" class="menu-profile-icon opened-menu-icon">
                            <path d="M12 2C6.47715 2 2 6.47715 2 12C2 17.5228 6.47715 22 12 22C17.5228 22 22 17.5228 22 12C22 6.47715 17.5228 2 12 2Z" stroke="#252525" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"></path>
                            <path d="M4.271 18.3457C4.271 18.3457 6.50002 15.5 12 15.5C17.5 15.5 19.7291 18.3457 19.7291 18.3457" stroke="#252525" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"></path>
                            <path d="M12 12C13.6569 12 15 10.6569 15 9C15 7.34315 13.6569 6 12 6C10.3431 6 9 7.34315 9 9C9 10.6569 10.3431 12 12 12Z" stroke="#252525" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"></path>
                        </svg>
                    </div>
                    <div class="opened-menu-right-border"></div>
                </button>
                <div class="opened-menu-vertical-line responsive-element"></div>
            </div>
        </div>
        <!-- Logo -->
        <img src="../static/img/home/logo-with-text.svg" alt="Clevercase Logo" class="desktop-logo" onclick="location.reload(true);">
        <div class="header-container-right">
            <button class="bell-icon-container header-btn">
                <img src="../static/img/home/notifications.svg" alt="Bell Icon" class="bell-icon">
            </button>
            <button class="profile-icon-container header-btn">
                <img src="../static/img/home/profile.svg" alt="Search Icon" class="profile-icon">
            </button>
        </div>
    </header>
    <main>
        <form method="post" action="{% url 'home' %}">
            <div id="main-content">
                <div class="add_category">
                    <div class="body_text">
                        Your categories
                    </div>
                    <button formnovalidate class="button-cat" type="button"> 
                        <svg xmlns="http://www.w3.org/2000/svg" width="44" height="44" viewBox="0 0 44 44">
                            <path fill-rule="evenodd" clip-rule="evenodd"
                                d="M38.171 7.08355C46.4091 16.0145 45.8476 29.9328 36.9167 38.171C27.9858 46.4091 14.0675 45.8476 5.82927 36.9167C-2.40892 27.9858 -1.84736 14.0675 7.08355 5.82927C16.0145 -2.40892 29.9328 -1.84736 38.171 7.08355ZM7.58284 22.011C7.58284 21.1826 8.25441 20.511 9.08284 20.511H20.7834V8.8116C20.7834 7.98317 21.455 7.3116 22.2834 7.3116C23.1119 7.3116 23.7834 7.98317 23.7834 8.8116V20.511H35.4828C36.3113 20.511 36.9828 21.1826 36.9828 22.011C36.9828 22.8394 36.3113 23.511 35.4828 23.511H23.7834V35.2116C23.7834 36.04 23.1119 36.7116 22.2834 36.7116C21.455 36.7116 20.7834 36.04 20.7834 35.2116V23.511H9.08284C8.25441 23.511 7.58284 22.8394 7.58284 22.011Z"
                                fill="#054E2B" />
                        </svg>
                    </button>
                </div>
                <div class="content-wrapper">

                    {% for category in categories %}
                    <div class="category-card" data-bgcolor="{{ category.color_save }}" style="background-color: {{ category.color_save }}">
                        <div class="category-text-content">
                            <div class="category-header">
                                <span class="category-title" data-bgcolor="{{ category.color_save }}">{{ category.cat_name }}</span>
                            </div>
                            <div class="category-content" data-bgcolor="{{ category.color_save }}">
                                  <div class="category-limit">
                                    <span class="limit-label">Limit:</span>
                                    <span class="limit-value">{{ category.the_limit }} {{ category.currency }}</span>
                                  </div>
                                  <div class="category-limit">
                                    <span class="limit-label">Expended:</span>
                                    <span class="limit-value">{{ category.currently_spent }} {{ category.currency }}</span>
                                  </div>
                            </div>
                        </div>
                        <div class="right-buttons">
                            <button formnovalidate class="category-action" ><img data-bgcolor="{{ category.color_save }}" class="category-action-image" src="../static/img/home/plus-circle.svg"></button>
                            <button formnovalidate class="category-edit" name="edit"  value="{{ category.id }}" ><img data-bgcolor="{{ category.color_save }}" class="category-edit-image" src="../static/img/home/pencil.svg"></button>
                        </div>
                    </div>
                    {% endfor %}
                </div>

                <div class="content-wrapper" >
                    <div class="form-container" id="colorful-object">
                        {% csrf_token %}
                        <div class="input-container">
                            <div class="text_box">Name of category</div>
                            {{ form.cat_name }}
                        </div>

                        <div class="input-container-date" class="input-text">
                            <div class="text_box">Period of tracking</div>
                            {{ form.date_of_rent }} â€“ {{ form.due_date }} {{ form.due_date.errors.as_ul }}
                            <div class="text_box">The limit</div>
                            {{ form.the_limit }}
                            {{ form.currency }}
                            {{ form.the_limit.errors.as_ul }}
                        </div>

                        <div class="text_box">Currently spent</div>
                        <div class="input-container-date" class="input-text" id="spent_text">
                            {{ form.currently_spent }} {{ form.currently_spent.errors.as_ul }}
                        </div>

                        <div class="text_box" data-error-count="{{ form.errors|length }}" id="error-count">Background color</div>
                        <div class="input-container-color" >
                            {{ form.color_save }}
                        </div>
                        <div class="container" >
                            <button class="submit-btn" value="{{ id }}" name="save">Save
                                changes</button>
                        </div>
                        <button formnovalidate  class="close-button">
                            <img src="../static/img/home/close.svg" alt="Close"
                                style="vertical-align: middle; position: absolute;right: 15px;top: 15px;">
                        </button>

                    </div>
                </div>
        </form>
        </div>
    </main>
    <script>
        document.addEventListener('DOMContentLoaded', () => {
            document.querySelectorAll('.category-card').forEach(card => {
                const bgColor = card.getAttribute('data-bgcolor');
                const textColor = getContrastYIQ(bgColor);
                card.style.color = textColor;
            });
            document.querySelectorAll('.category-title').forEach(card => {
                const bgColor = card.getAttribute('data-bgcolor');
                const textColor = getContrastYIQ(bgColor);
                card.style.color = textColor;
            });
            document.querySelectorAll('.category-content').forEach(card => {
                const bgColor = card.getAttribute('data-bgcolor');
                const textColor = getContrastYIQ(bgColor);
                card.style.setProperty('--border-top-color', textColor);
            });
            document.querySelectorAll('.category-action-image').forEach(card => {
                if (card.hasAttribute('data-bgcolor')) {
                    const bgColor = card.getAttribute('data-bgcolor');
                    const textColor = getContrastYIQ(bgColor);
                    if (textColor == 'black') {
                        card.src = "../static/img/home/black-plus.svg";
                    }
                }
            });
            document.querySelectorAll('.category-edit-image').forEach(card => {
                if (card.hasAttribute('data-bgcolor')) {
                    const bgColor = card.getAttribute('data-bgcolor');
                    const textColor = getContrastYIQ(bgColor);
                    if (textColor == 'black') {
                        card.src = "../static/img/home/black-pencil.svg";
                    }
                }
            });
            var div = document.getElementById('colorful-object');
            var displayState = localStorage.getItem('displayState');
            var errorCountElement = document.getElementById('error-count');
            var errorCount = errorCountElement.getAttribute('data-error-count');
            console.log(errorCount)
            if(errorCount == 0) {
                if (displayState) {
                    div.style.display = displayState;
                }
            }else{
                div.style.display = 'block';
                displayState = 'block';
            }
        });
        document.addEventListener('DOMContentLoaded', (event) => {
            function toggleVisibility() {
                var div = document.getElementById('colorful-object');
                var errorCountElement = document.getElementById('error-count');
                var errorCount = errorCountElement.getAttribute('data-error-count');
                console.log(errorCount)
                if(errorCount == 0) {
                    console.log("mm")
                    if (div.style.display === 'none' || div.style.display === '') {
                        div.style.display = 'block';
                        localStorage.setItem('displayState', 'block');
                    } else {
                        div.style.display = 'none';
                        localStorage.setItem('displayState', 'none');
                    }
                }
            }
            document.querySelectorAll('.category-action, .category-edit, .button-cat, .close-button, .submit-btn').forEach(button => {
                button.addEventListener('click', toggleVisibility);
            });
        });

        function getContrastYIQ(hexcolor){
            hexcolor = hexcolor.replace("#", "");
            var r = parseInt(hexcolor.substr(0,2),16);
            var g = parseInt(hexcolor.substr(2,2),16);
            var b = parseInt(hexcolor.substr(4,2),16);
            var yiq = ((r*299)+(g*587)+(b*114))/1000;
            return (yiq >= 180) ? 'black' : 'white';
        }

        
    </script>
    <script src="../static/scripts/create_cat.js"></script>
    <script src="../static/scripts/script.js"></script>
</body>

</html>